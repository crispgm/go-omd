#!/usr/bin/env ruby

argv = ARGV.dup
argv_extra = []

if idx = argv.index("--")
    argv_extra = argv.slice(idx+1, argv.length-2)
    argv = argv.slice(0, idx)
end

if argv.include?("--version")
    require_relative "../lib/olympia/version"
    puts "Olympia #{Olympia::VERSION}"
    exit 0
end

begin

    require 'sinatra'
    require_relative "../lib/olympia/camera"

    set :public_folder, settings.root + '/../public'
    set :views, settings.root + '/../templates'
    set :bind, '0.0.0.0'
    set :port, 9494

    $camera = Olympia::Camera.new

    get '/' do
        home
    end

    get '/home' do
        home
    end

    get '/about' do
        about
    end

    get '/albums' do
    end

    get '/list' do
        list
    end

    get '/info' do
        info
    end

    def home
        #cam_info = $camera.get_caminfo
        cam_info = 'camtest'
        connect_mode = 'aaa'
        props = { :Aperture => '1.2', :ShutterSpeed => '1/2000', :ISO => '200', :CameraMode => 'AperturePrior' }
        if cam_info.eql? "Olympia: NET ERROR"
            cam_info = "&lt;Device Not Connected&gt;"
        end
        erb :index, :locals => {:title => 'Home', :cam_info => cam_info, :connect_mode => connect_mode, :props => props}
    end

    def about
        "About"
    end

    def list
        $camera.get_imglist
    end

    def info
        $camera.get_caminfo
    end
end
